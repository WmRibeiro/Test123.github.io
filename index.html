<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Empilhadeira</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --primary:#2563eb;
  --danger:#ef4444;
  --success:#22c55e;
  --border:#e2e8f0;
  --bg:#f1f5f9;
}

*{box-sizing:border-box}

body{
  font-family:system-ui,Arial;
  background:linear-gradient(135deg,#e0e7ff,#f8fafc);
  padding:16px;
}

.container{
  max-width:760px;
  margin:auto;
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

h2{text-align:center;color:#1e40af}

.card{
  margin-top:20px;
  padding:18px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#f8fafc;
}

.card h3{margin:0 0 12px;color:#1e40af}

label{
  font-weight:600;
  margin-top:10px;
  display:block;
}

input,select,textarea{
  width:100%;
  padding:12px;
  margin-top:5px;
  border-radius:10px;
  border:1px solid var(--border);
}

textarea{min-height:70px}

.select-ok{background:#f0fdf4;border-color:var(--success)}
.select-erro{background:#fef2f2;border-color:var(--danger)}

.foto-obrigatoria{
  border-left:4px solid var(--primary);
  padding-left:10px;
}

canvas{
  border:2px dashed #94a3b8;
  border-radius:10px;
  background:#fff;
  margin-top:8px;
  touch-action:none;
}

button{
  margin-top:26px;
  width:100%;
  padding:14px;
  font-size:1rem;
  font-weight:600;
  color:#fff;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">
<h2>Checklist ‚Äì Empilhadeira</h2>

<label>Nome do Colaborador</label>
<input id="colaborador">

<label>Matr√≠cula</label>
<input id="matricula">

<div id="dataHora"></div>

<!-- SEGURAN√áA -->
<div class="card">
<h3>üîß Seguran√ßa</h3>

<label>Buzina</label>
<select id="buzina" class="avaliacao">
<option>Funcionando</option>
<option>N√£o Funcionando</option>
</select>
<input type="file" id="fotoBuzina" class="foto-obrigatoria" accept="image/*" capture="camera">

<label>Sistemas de r√©, lanternas e retrovisores</label>
<select id="sistemas" class="avaliacao">
<option>Sim</option>
<option>N√£o</option>
</select>
<input type="file" id="fotoSistemas" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- ESTRUTURA -->
<div class="card">
<h3>üöú Estrutura</h3>

<label>Pneus</label>
<select id="pneus" class="avaliacao">
<option>Bom</option>
<option>Regular</option>
<option>Ruim</option>
</select>
<input type="file" id="fotoPneus" class="foto-obrigatoria" accept="image/*" capture="camera">

<label>Garfo</label>
<select id="garfo" class="avaliacao">
<option>Ok</option>
<option>N√£o</option>
</select>
<input type="file" id="fotoGarfo" class="foto-obrigatoria" accept="image/*" capture="camera">

<label>Sistema de eleva√ß√£o</label>
<select id="elevacao" class="avaliacao">
<option>Funcionando</option>
<option>N√£o Funcionando</option>
</select>
<input type="file" id="fotoElevacao" class="foto-obrigatoria" accept="image/*" capture="camera">

<label>Dire√ß√£o hidr√°ulica</label>
<select id="direcao" class="avaliacao">
<option>Ok</option>
<option>N√£o</option>
</select>
<input type="file" id="fotoDirecao" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- FREIOS / FLUIDOS -->
<div class="card">
<h3>üõ¢Ô∏è Freios e Fluidos</h3>

<label>Sistema de freios</label>
<select id="freios" class="avaliacao">
<option>Ok</option>
<option>N√£o</option>
</select>
<input type="file" id="fotoFreios" class="foto-obrigatoria" accept="image/*" capture="camera">

<label>N√≠vel de fluido (freios)</label>
<select id="fluido" class="avaliacao">
<option>Cheio</option>
<option>Vazio</option>
</select>
<input type="file" id="fotoFluido" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- VAZAMENTO -->
<div class="card">
<h3>üíß Vazamentos</h3>

<label>Existe algum vazamento?</label>
<select id="vazamento" class="avaliacao">
<option>N√£o</option>
<option>Sim</option>
</select>
<textarea id="tipoVazamento" placeholder="Qual vazamento?"></textarea>
<input type="file" id="fotoVazamento" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- LIMPEZA -->
<div class="card">
<h3>üßº Limpeza</h3>

<label>Limpeza</label>
<select id="limpeza" class="avaliacao">
<option>Realizada</option>
<option>N√£o Realizada</option>
</select>
<textarea id="obsLimpeza" placeholder="Observa√ß√µes"></textarea>
<input type="file" id="fotoLimpeza" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- G√ÅS -->
<div class="card">
<h3>üî• Cilindro de G√°s</h3>

<label>Cilindro de g√°s</label>
<select id="gas" class="avaliacao">
<option>Ok</option>
<option>N√£o</option>
</select>
<input type="file" id="fotoGas" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- ASSINATURA -->
<div class="card">
<h3>üßæ Assinatura do Operador</h3>
<canvas id="assinatura" width="320" height="120"></canvas>
<button type="button" onclick="limparAssinatura()">Limpar assinatura</button>
</div>

<button onclick="gerarPDF()">Gerar PDF</button>
</div>

<script>
dataHora.innerText="Data/Hora: "+new Date().toLocaleString();

/* CORES AUTOM√ÅTICAS */
document.querySelectorAll(".avaliacao").forEach(s=>{
  s.onchange=()=>{
    s.classList.remove("select-ok","select-erro");
    if(s.value.includes("N√£o")||s.value.includes("Ruim")||s.value==="Sim"){
      s.classList.add("select-erro");
    }else s.classList.add("select-ok");
  };
});

/* ASSINATURA */
const canvas=document.getElementById("assinatura");
const ctx=canvas.getContext("2d");
let draw=false;
function p(e){
  const r=canvas.getBoundingClientRect();
  return{
    x:(e.touches?e.touches[0].clientX:e.clientX)-r.left,
    y:(e.touches?e.touches[0].clientY:e.clientY)-r.top
  };
}
canvas.onmousedown=()=>draw=true;
canvas.onmouseup=()=>draw=false;
canvas.onmousemove=e=>{
  if(!draw)return;
  const a=p(e);ctx.lineTo(a.x,a.y);ctx.stroke();
};
canvas.ontouchstart=()=>draw=true;
canvas.ontouchend=()=>draw=false;
canvas.ontouchmove=e=>{
  e.preventDefault();
  if(!draw)return;
  const a=p(e);ctx.lineTo(a.x,a.y);ctx.stroke();
};
ctx.lineWidth=2;ctx.lineCap="round";
function limparAssinatura(){ctx.clearRect(0,0,canvas.width,canvas.height);}

/* VALIDA√á√ÉO */
function validar(){
  let ok=true;
  document.querySelectorAll(".avaliacao").forEach(s=>{
    const f=s.nextElementSibling;
    if((s.classList.contains("select-erro")) && f && f.type==="file" && f.files.length===0){
      ok=false;
    }
  });
  if(!ok) alert("‚ùå Itens com problema exigem foto!");
  return ok;
}

/* PDF */
async function gerarPDF(){
  if(!validar())return;
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  let y=15;

  doc.setFontSize(16);
  doc.text("Checklist de Empilhadeira",105,y,{align:"center"});
  y+=10;

  doc.setFontSize(10);
  doc.text("Colaborador: "+colaborador.value,10,y);
  doc.text("Matr√≠cula: "+matricula.value,140,y);
  y+=6;
  doc.text(dataHora.innerText,10,y);
  y+=10;

  async function item(nome,valor,foto){
    doc.text(nome+": "+valor,10,y);y+=5;
    if(foto.files[0]){
      const img=await new Promise(r=>{
        const fr=new FileReader();
        fr.onload=e=>r(e.target.result);
        fr.readAsDataURL(foto.files[0]);
      });
      doc.addImage(img,"JPEG",10,y,50,35);
      y+=40;
    }
  }

  await item("Pneus",pneus.value,fotoPneus);
  await item("Buzina",buzina.value,fotoBuzina);
  await item("Freios",freios.value,fotoFreios);
  await item("Eleva√ß√£o",elevacao.value,fotoElevacao);
  await item("Dire√ß√£o",direcao.value,fotoDirecao);
  await item("Vazamento",vazamento.value,fotoVazamento);
  await item("Limpeza",limpeza.value,fotoLimpeza);
  await item("G√°s",gas.value,fotoGas);

  doc.text("Assinatura:",10,y);y+=5;
  doc.addImage(canvas.toDataURL(),"PNG",10,y,60,25);

  salvarHistorico();
  doc.save("checklist_empilhadeira.pdf");
  enviarWhats();
}

/* HIST√ìRICO */
function salvarHistorico(){
  const h=JSON.parse(localStorage.getItem("checklists")||"[]");
  h.push({nome:colaborador.value,data:new Date().toLocaleString()});
  localStorage.setItem("checklists",JSON.stringify(h));
}

/* WHATSAPP */
function enviarWhats(){
  const m=encodeURIComponent("Checklist de empilhadeira realizado por "+colaborador.value);
  window.open("https://wa.me/?text="+m,"_blank");
}
</script>
</body>
</html>
