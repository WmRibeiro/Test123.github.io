<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Empilhadeira</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --primary:#2563eb;
  --danger:#ef4444;
  --success:#22c55e;
  --bg:#f1f5f9;
  --card:#ffffff;
  --border:#e2e8f0;
}

* { box-sizing:border-box }

body {
  font-family: system-ui, Arial;
  background: linear-gradient(135deg,#e0e7ff,#f8fafc);
  padding:16px;
}

.container {
  max-width:720px;
  margin:auto;
  background:var(--card);
  padding:24px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

h2 {
  text-align:center;
  color:#1e40af;
}

.card {
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
  margin-top:20px;
  background:#f8fafc;
}

.card h3 {
  margin:0 0 10px;
  color:#1e40af;
}

label {
  font-weight:600;
  margin-top:12px;
  display:block;
}

input, select, textarea {
  width:100%;
  padding:12px;
  margin-top:5px;
  border-radius:10px;
  border:1px solid var(--border);
}

textarea { min-height:70px }

.select-ok {
  border-color:var(--success);
  background:#f0fdf4;
}

.select-erro {
  border-color:var(--danger);
  background:#fef2f2;
}

.foto-obrigatoria {
  border-left:4px solid var(--primary);
  padding-left:10px;
}

canvas {
  border:2px dashed #94a3b8;
  border-radius:10px;
  background:#fff;
  margin-top:8px;
  touch-action:none;
}

button {
  margin-top:25px;
  width:100%;
  padding:14px;
  font-size:1rem;
  font-weight:600;
  color:#fff;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">
<h2>Checklist de Empilhadeira</h2>

<label>Colaborador</label>
<input id="colaborador">

<label>MatrÃ­cula</label>
<input id="matricula">

<div id="dataHora"></div>

<!-- CARD SEGURANÃ‡A -->
<div class="card">
<h3>ðŸ”§ SeguranÃ§a</h3>

<label>Buzina</label>
<select id="buzina" class="avaliacao">
  <option>Funcionando</option>
  <option>NÃ£o Funcionando</option>
</select>
<input type="file" id="fotoBuzina" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- CARD ESTRUTURA -->
<div class="card">
<h3>ðŸšœ Estrutura</h3>

<label>Pneus</label>
<select id="pneus" class="avaliacao">
  <option>Bom</option>
  <option>Regular</option>
  <option>Ruim</option>
</select>
<input type="file" id="fotoPneus" class="foto-obrigatoria" accept="image/*" capture="camera">
</div>

<!-- CARD ASSINATURA -->
<div class="card">
<h3>ðŸ§¾ Assinatura do Operador</h3>
<canvas id="assinatura" width="300" height="120"></canvas>
<button type="button" onclick="limparAssinatura()">Limpar assinatura</button>
</div>

<button onclick="gerarPDF()">Gerar PDF</button>
</div>

<script>
document.getElementById("dataHora").innerText =
"Data/Hora: " + new Date().toLocaleString();

/* CORES AUTOMÃTICAS */
document.querySelectorAll(".avaliacao").forEach(sel=>{
  sel.addEventListener("change",()=>{
    sel.classList.remove("select-ok","select-erro");
    if(sel.value.includes("NÃ£o")||sel.value.includes("Ruim")){
      sel.classList.add("select-erro");
    } else {
      sel.classList.add("select-ok");
    }
  });
});

/* ASSINATURA */
const canvas=document.getElementById("assinatura");
const ctx=canvas.getContext("2d");
let draw=false;

function pos(e){
  const r=canvas.getBoundingClientRect();
  return {
    x:(e.touches?e.touches[0].clientX:e.clientX)-r.left,
    y:(e.touches?e.touches[0].clientY:e.clientY)-r.top
  };
}

canvas.onmousedown=()=>draw=true;
canvas.onmouseup=()=>draw=false;
canvas.onmousemove=e=>{
  if(!draw)return;
  const p=pos(e);
  ctx.lineTo(p.x,p.y);
  ctx.stroke();
};
canvas.ontouchstart=()=>draw=true;
canvas.ontouchend=()=>draw=false;
canvas.ontouchmove=e=>{
  e.preventDefault();
  if(!draw)return;
  const p=pos(e);
  ctx.lineTo(p.x,p.y);
  ctx.stroke();
};
ctx.lineWidth=2;
ctx.lineCap="round";

function limparAssinatura(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* VALIDAÃ‡ÃƒO */
function validar(){
  let ok=true;
  document.querySelectorAll(".avaliacao").forEach(sel=>{
    const foto=sel.nextElementSibling;
    if((sel.value.includes("NÃ£o")||sel.value.includes("Ruim")) && foto.files.length===0){
      ok=false;
    }
  });
  if(!ok) alert("Itens com problema exigem foto!");
  return ok;
}

/* PDF */
async function gerarPDF(){
  if(!validar()) return;

  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  let y=15;

  doc.setFontSize(16);
  doc.text("Checklist de Empilhadeira",105,y,{align:"center"});
  y+=10;

  doc.setFontSize(10);
  doc.text("Colaborador: "+colaborador.value,10,y);
  doc.text("MatrÃ­cula: "+matricula.value,140,y);
  y+=6;
  doc.text(dataHora.innerText,10,y);
  y+=10;

  async function item(nome,selectId,fotoId){
    doc.text(nome+": "+document.getElementById(selectId).value,10,y);
    y+=5;
    const file=document.getElementById(fotoId).files[0];
    if(file){
      const img=await new Promise(r=>{
        const fr=new FileReader();
        fr.onload=e=>r(e.target.result);
        fr.readAsDataURL(file);
      });
      doc.addImage(img,"JPEG",10,y,50,35);
      y+=40;
    }
  }

  await item("Buzina","buzina","fotoBuzina");
  await item("Pneus","pneus","fotoPneus");

  doc.text("Assinatura:",10,y);
  y+=5;
  doc.addImage(canvas.toDataURL(),"PNG",10,y,60,25);

  salvarHistorico();
  doc.save("checklist_empilhadeira.pdf");
  enviarWhats();
}

/* HISTÃ“RICO */
function salvarHistorico(){
  const h=JSON.parse(localStorage.getItem("checklists")||"[]");
  h.push({colaborador:colaborador.value,data:new Date().toLocaleString()});
  localStorage.setItem("checklists",JSON.stringify(h));
}

/* WHATSAPP */
function enviarWhats(){
  const msg=encodeURIComponent("Checklist realizado por "+colaborador.value);
  window.open("https://wa.me/?text="+msg,"_blank");
}
</script>
</body>
</html>
